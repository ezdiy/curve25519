#include "test/common.h"

static test_field_vector_t mul_vectors[] = {
  {
    .a = {
      0xec, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff,
      0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff,
      0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff,
      0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x7f
    },
    .b = {
      0xec, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff,
      0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff,
      0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff,
      0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x7f
    },
    .expected = {
      0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
      0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
      0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
      0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
    },
    .description = "(p - 1)^2"
  },
  {
    .a = {
      0x44, 0x6b, 0x37, 0x9d, 0x72, 0x97, 0xcb, 0x7c,
      0x25, 0x19, 0x34, 0xe5, 0x59, 0x0c, 0x89, 0xff,
      0xa5, 0x23, 0xc2, 0x52, 0xe0, 0x17, 0x85, 0x97,
      0xe4, 0x91, 0x00, 0x94, 0xa9, 0xd0, 0xe4, 0x4e
    },
    .b = {
      0xea, 0x14, 0xa8, 0xb2, 0x20, 0xb0, 0x49, 0x8a,
      0x09, 0xda, 0x32, 0x68, 0xda, 0xed, 0x9e, 0xdd,
      0x65, 0x55, 0xd4, 0x73, 0xae, 0x0d, 0xcf, 0xf3,
      0x3d, 0xfa, 0x7b, 0x53, 0xb9, 0x6b, 0xad, 0x2a
    },
    .expected = {
      0x7b, 0x03, 0x4b, 0x45, 0xf9, 0x5f, 0x64, 0xb9,
      0xd3, 0x28, 0xab, 0x05, 0xeb, 0x3c, 0xca, 0xb7,
      0x13, 0x8a, 0xe0, 0xbc, 0xc4, 0x8a, 0x7b, 0x3a,
      0x49, 0x3e, 0x24, 0xa4, 0xca, 0xc4, 0xcf, 0x28
    },
    .description = "random data"
  }
};

TEST_IMPL(field_mul) {
  unsigned int i;

  for (i = 0; i < ARRAY_SIZE(mul_vectors); i++) {
    curve25519_num_t a;
    curve25519_num_t b;
    uint8_t bin[32];

    curve25519_num_from_bin(&a, mul_vectors[i].a);
    curve25519_num_from_bin(&b, mul_vectors[i].b);
    curve25519_num_mul(&a, &a, &b);
    curve25519_num_to_bin(bin, &a);

    check_equal_data(bin, mul_vectors[i].expected, sizeof(bin),
                     mul_vectors[i].description);
  }
}
