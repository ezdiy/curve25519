#include "test/common.h"

static test_field_single_vector_t sqr_vectors[] = {
  {
    .num = {
      0xec, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff,
      0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff,
      0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff,
      0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x7f
    },
    .expected = {
      0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
      0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
      0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
      0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
    },
    .description = "(p - 1)^2 square"
  }
};

TEST_IMPL(field_sqr) {
  unsigned int i;

  for (i = 0; i < ARRAY_SIZE(sqr_vectors); i++) {
    test_field_single_vector_t* vec;
    curve25519_num_t num;
    uint8_t bin[32];

    vec = &sqr_vectors[i];

    curve25519_num_from_bin(&num, vec->num);
    curve25519_num_sqr(&num, &num);
    curve25519_num_to_bin(bin, &num);

    check_equal_data(bin, vec->expected, sizeof(bin), vec->description);
  }
}
