#include "test/common.h"

TEST_IMPL(vanity) {
  static const curve22519_ed_vanity_options_t opts = {
    .point = {
      0x9d, 0x95, 0xd6, 0x08, 0x87, 0xfe, 0x40, 0x9b,
      0x43, 0x23, 0x7f, 0x39, 0x76, 0x70, 0x9b, 0xbd,
      0x32, 0x3f, 0xdd, 0x15, 0x83, 0x6d, 0x4e, 0x47,
      0x36, 0xe8, 0xe0, 0x60, 0x73, 0xa7, 0x5e, 0x4a
    },
    .rnd = {
      0x02, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
      0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
      0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
      0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
    },
    .postfix = {
      0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
      0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
      0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
      0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x03, 0x45
    },
    .max_tries = 0x1000000,
    .postfix_len = 12
  };
  uint8_t out[32];
  unsigned int tries;
  curve25519_ed_point_t p;

  CHECK_EQ(curve25519_ed_vanity(out, &tries, &opts), 1,
           "vanity should find the point");
  CHECK_EQ(tries, 508, "vanity should find right amount of tries");

  CHECK_EQ(curve25519_ed_point_from_bin(&p, opts.point), 0,
           "point from bin");
  curve25519_ed_point_scalar_mul(&p, &p, out);
  curve25519_ed_point_to_bin(out, &p);

  CHECK_EQ(out[30], 0x03, "pre-last byte");
  CHECK_EQ(out[31], 0x45, "last byte");
}
