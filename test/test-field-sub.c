#include "test/common.h"

test_field_vector_t sub_vectors[] = {
  {
    .a = {
      0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff,
      0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff,
      0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff,
      0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x7f, 0x00
    },
    .b = {
      0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff,
      0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff,
      0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff,
      0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x7f
    },
    .expected = {
      0xed, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff,
      0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff,
      0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff,
      0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x7f, 0x00
    },
    .description = "sub with carry"
  },
  {
    .a = {
      0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
      0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
      0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
      0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x7f
    },
    .b = {
      0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
      0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
      0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
      0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00
    },
    .expected = {
      0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff,
      0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff,
      0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff,
      0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0x7e
    },
    .description = "sub with partial carry"
  },
  {
    .a = {
      0xd4, 0x19, 0x02, 0xc4, 0x36, 0x68, 0x24, 0x43,
      0x99, 0x83, 0x67, 0xde, 0xad, 0xeb, 0xdd, 0xcb,
      0x22, 0x24, 0xd7, 0xca, 0xec, 0xa6, 0x9f, 0xf3,
      0xa4, 0x69, 0xd0, 0x07, 0xce, 0xa5, 0x1c, 0x32
    },
    .b = {
      0xd0, 0xaf, 0xcd, 0xe7, 0xaf, 0xa9, 0xa7, 0x3b,
      0xc3, 0x82, 0xaa, 0x09, 0x66, 0x6b, 0x42, 0x12,
      0x78, 0x0f, 0x3a, 0x8b, 0xb1, 0x61, 0xbc, 0x55,
      0x79, 0xde, 0x8c, 0xe7, 0x3e, 0x20, 0x2c, 0x08
    },
    .expected = {
      0x04, 0x6a, 0x34, 0xdc, 0x86, 0xbe, 0x7c, 0x07,
      0xd6, 0x00, 0xbd, 0xd4, 0x47, 0x80, 0x9b, 0xb9,
      0xaa, 0x14, 0x9d, 0x3f, 0x3b, 0x45, 0xe3, 0x9d,
      0x2b, 0x8b, 0x43, 0x20, 0x8f, 0x85, 0xf0, 0x29
    },
    .description = "random data"
  }
};

TEST_IMPL(field_sub) {
  unsigned int i;

  for (i = 0; i < ARRAY_SIZE(sub_vectors); i++) {
    curve25519_num_t a;
    curve25519_num_t b;
    uint8_t bin[32];

    curve25519_num_from_bin(&a, sub_vectors[i].a);
    curve25519_num_from_bin(&b, sub_vectors[i].b);
    curve25519_num_sub(&a, &b);
    curve25519_num_to_bin(bin, &a);

    check_equal_data(bin, sub_vectors[i].expected, sizeof(bin),
                     sub_vectors[i].description);
  }
}
